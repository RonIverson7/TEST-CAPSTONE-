import React, { useState, useEffect } from 'react';
import { SafeAreaView, StyleSheet, View, Text, TouchableOpacity, ScrollView, Modal, TextInput, Platform, KeyboardAvoidingView, Image, Alert } from 'react-native';
import * as ImagePicker from 'expo-image-picker';
import AsyncStorage from '@react-native-async-storage/async-storage';
import DateTimePicker from '@react-native-community/datetimepicker';
import { Ionicons } from '@expo/vector-icons';
import Header from '../components/Header';
import { supabase } from '../../supabase/supabaseClient';
import { useUser } from '../contexts/UserContext';

const API_BASE = 'http://192.168.18.22:3000/api';

export default function SettingsScreen() {
  const { userData, refreshUserData } = useUser();
  const role = userData?.role || null;

  // Edit Profile state
  const [modalVisible, setModalVisible] = useState(false);
  const [tempImage, setTempImage] = useState(null);
  const [tempBackgroundImage, setTempBackgroundImage] = useState(null);
  const [tempFirstName, setTempFirstName] = useState('');
  const [tempMiddleName, setTempMiddleName] = useState('');
  const [tempLastName, setTempLastName] = useState('');
  const [tempUserNameField, setTempUserNameField] = useState('');
  const [tempSex, setTempSex] = useState('');
  const [tempBirthday, setTempBirthday] = useState(new Date());
  const [tempAddress, setTempAddress] = useState('');
  const [tempBio, setTempBio] = useState('');
  const [tempAbout, setTempAbout] = useState('');
  const [showDatePicker, setShowDatePicker] = useState(false);
  const [showSexDropdown, setShowSexDropdown] = useState(false);

  // Apply as Artist state
  const [applyModalVisible, setApplyModalVisible] = useState(false);
  const [appFirstName, setAppFirstName] = useState('');
  const [appMiddleInitial, setAppMiddleInitial] = useState('');
  const [appLastName, setAppLastName] = useState('');
  const [appPhone, setAppPhone] = useState('');
  const [appAge, setAppAge] = useState('');
  const [appSex, setAppSex] = useState('');
  const [appBirthdate, setAppBirthdate] = useState(new Date());
  const [appShowSexDropdown, setAppShowSexDropdown] = useState(false);
  const [appShowDatePicker, setAppShowDatePicker] = useState(false);
  const [appAddress, setAppAddress] = useState('');
  const [appValidIdImage, setAppValidIdImage] = useState(null);
  const [appSelfieImage, setAppSelfieImage] = useState(null);
  const [appSubmitting, setAppSubmitting] = useState(false);

  // User profile state
  const [firstName, setFirstName] = useState('');
  const [middleName, setMiddleName] = useState('');
  const [lastName, setLastName] = useState('');
  const [username, setUsername] = useState('');
  const [sex, setSex] = useState('');
  const [birthday, setBirthday] = useState(new Date());
  const [address, setAddress] = useState('');
  const [bio, setBio] = useState('');
  const [about, setAbout] = useState('');
  const [image, setImage] = useState(null);
  const [backgroundImage, setBackgroundImage] = useState(null);
  const [accessToken, setAccessToken] = useState(null);
  const [refreshToken, setRefreshToken] = useState(null);
  const [hasPendingRequest, setHasPendingRequest] = useState(false);

  const formattedTempDate = tempBirthday
    ? tempBirthday.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
    : '';

  // Load tokens and profile on mount
  useEffect(() => {
    const init = async () => {
      const { data } = await supabase.auth.getSession();
      const at = data?.session?.access_token || null;
      const rt = data?.session?.refresh_token || null;
      setAccessToken(at);
      setRefreshToken(rt);
      if (at && rt) {
        await fetchProfile(at, rt);
        await checkPendingRequest(at, rt);
      }
    };
    init();
  }, []);

  const fetchProfile = async (at, rt) => {
    try {
      const res = await fetch(`${API_BASE}/profile/getProfile`, {
        method: 'GET',
        headers: { Cookie: `access_token=${at}; refresh_token=${rt}` },
      });
      if (!res.ok) return;
      const data = await res.json();
      const p = data?.profile ?? data;
      setFirstName(p.firstName || '');
      setMiddleName(p.middleName || '');
      setLastName(p.lastName || '');
      setUsername(p.username || '');
      setSex(p.sex || '');
      setAddress(p.address || '');
      setBio(p.bio || '');
      setAbout(p.about || '');
      if (p.birthday || p.birthdate) setBirthday(new Date(p.birthday || p.birthdate));
    } catch {}
  };

  const checkPendingRequest = async (at, rt) => {
    try {
      const res = await fetch(`${API_BASE}/request/getRequest`, {
        method: 'GET',
        headers: { Cookie: `access_token=${at}; refresh_token=${rt}` },
      });
      if (!res.ok) { setHasPendingRequest(false); return; }
      const data = await res.json();
      if (data?.requests && Array.isArray(data.requests)) {
        const pending = data.requests.find(r => r.requestType === 'artist_verification' && r.status === 'pending');
        setHasPendingRequest(!!pending);
      }
    } catch {}
  };

  const pickImage = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [1, 1],
      quality: 1,
    });
    if (!result.canceled) {
      const imgObj = { uri: result.assets[0].uri };
      setTempImage(imgObj);
    }
  };

  const pickBackgroundImage = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [16, 9],
      quality: 1,
    });
    if (!result.canceled) {
      setTempBackgroundImage({ uri: result.assets[0].uri });
    }
  };

  const handleSave = async () => {
    try {
      const formData = new FormData();
      if (tempImage) {
        const filename = tempImage.uri.split('/').pop();
        const match = /\.(\w+)$/.exec(filename);
        const type = match ? `image/${match[1]}` : 'image';
        formData.append('avatar', { uri: tempImage.uri, name: filename, type });
      }
      if (tempBackgroundImage) {
        const filename = tempBackgroundImage.uri.split('/').pop();
        const match = /\.(\w+)$/.exec(filename);
        const type = match ? `image/${match[1]}` : 'image';
        formData.append('cover', { uri: tempBackgroundImage.uri, name: filename, type });
      }
      formData.append('firstName', String(tempFirstName ?? ''));
      formData.append('middleName', String(tempMiddleName ?? ''));
      formData.append('lastName', String(tempLastName ?? ''));
      formData.append('username', String(tempUserNameField || username || ''));
      formData.append('sex', String(tempSex ?? ''));
      const birthdayISO = tempBirthday ? new Date(tempBirthday).toISOString() : '';
      formData.append('birthday', birthdayISO);
      formData.append('birthdate', birthdayISO);
      formData.append('address', String(tempAddress ?? ''));
      formData.append('bio', String(tempBio ?? ''));
      formData.append('about', String(tempAbout ?? ''));
      if (tempBirthday) await AsyncStorage.setItem('userBirthday', new Date(tempBirthday).toISOString());
      const res = await fetch(`${API_BASE}/profile/updateProfile`, {
        method: 'POST',
        headers: { Cookie: `access_token=${accessToken}; refresh_token=${refreshToken}` },
        body: formData,
      });
      if (!res.ok) throw new Error('Failed to update profile');
      setModalVisible(false);
      await fetchProfile(accessToken, refreshToken);
      await refreshUserData();
      Alert.alert('Success', 'Profile updated successfully!');
    } catch (err) {
      Alert.alert('Update Failed', err?.message || 'Failed to save profile');
    }
  };

  const onChangeTempDate = (event, selectedDate) => {
    if (selectedDate) setTempBirthday(selectedDate);
    if (Platform.OS === 'android') setShowDatePicker(false);
  };

  const handleApplyAsArtist = () => {
    setAppFirstName(firstName || '');
    setAppMiddleInitial((middleName || '').slice(0,1).toUpperCase());
    setAppLastName(lastName || '');
    setAppSex(sex || '');
    setAppBirthdate(birthday || new Date());
    setAppAddress(address || '');
    setAppPhone('');
    setAppAge('');
    setAppValidIdImage(null);
    setAppSelfieImage(null);
    setApplyModalVisible(true);
  };

  const pickValidIdImage = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [4, 3],
      quality: 1,
    });
    if (!result.canceled) setAppValidIdImage({ uri: result.assets[0].uri });
  };

  const pickSelfieImage = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [1, 1],
      quality: 1,
    });
    if (!result.canceled) setAppSelfieImage({ uri: result.assets[0].uri });
  };

  const onChangeAppDate = (event, selectedDate) => {
    if (selectedDate) setAppBirthdate(selectedDate);
    if (Platform.OS === 'android') setAppShowDatePicker(false);
  };

  const submitArtistApplication = async () => {
    try {
      if (!appFirstName || !appLastName || !appPhone || !appAge || !appSex || !appBirthdate || !appAddress || !appValidIdImage || !appSelfieImage) {
        Alert.alert('Incomplete', 'Please fill in all fields and attach both images.');
        return;
      }
      setAppSubmitting(true);
      let at = accessToken, rt = refreshToken;
      if (!at || !rt) {
        const { data } = await supabase.auth.getSession();
        at = data?.session?.access_token || at;
        rt = data?.session?.refresh_token || rt;
      }
      const fd = new FormData();
      fd.append('requestType', 'artist_verification');
      fd.append('firstName', String(appFirstName));
      fd.append('midInit', String(appMiddleInitial || ''));
      fd.append('lastName', String(appLastName));
      fd.append('phone', String(appPhone));
      fd.append('age', String(appAge));
      fd.append('sex', String(appSex));
      fd.append('birthdate', new Date(appBirthdate).toISOString());
      fd.append('address', String(appAddress));
      fd.append('portfolio', '');
      fd.append('bio', '');
      fd.append('consent', 'true');
      fd.append('file', { uri: appValidIdImage.uri, name: 'valid_id.jpg', type: 'image/jpeg' });
      fd.append('file2', { uri: appSelfieImage.uri, name: 'selfie.jpg', type: 'image/jpeg' });
      const res = await fetch(`${API_BASE}/request/registerAsArtist`, {
        method: 'POST',
        headers: { Cookie: `access_token=${at}; refresh_token=${rt}` },
        body: fd,
      });
      const bodyText = await res.text();
      if (!res.ok) throw new Error(bodyText || 'Application failed');
      await checkPendingRequest(at, rt);
      await refreshUserData();
      Alert.alert('Submitted', 'Your application has been submitted.');
      setApplyModalVisible(false);
    } catch (e) {
      Alert.alert('Failed', e?.message || 'Could not submit application');
    } finally {
      setAppSubmitting(false);
    }
  };

  const openEditProfile = () => {
    setTempImage(image);
    setTempBackgroundImage(backgroundImage);
    setTempFirstName(firstName);
    setTempMiddleName(middleName);
    setTempLastName(lastName);
    setTempUserNameField(username);
    setTempSex(sex);
    setTempBirthday(birthday || new Date());
    setTempAddress(address);
    setTempBio(bio);
    setTempAbout(about);
    setModalVisible(true);
  };

  return (
    <SafeAreaView style={styles.container}>
      <Header title="Settings" />
      <ScrollView contentContainerStyle={styles.content}>
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Profile</Text>
          <TouchableOpacity style={styles.item} onPress={openEditProfile}>
            <View style={styles.itemRow}>
              <View style={styles.itemLeft}>
                <View style={styles.itemIconWrap}>
                  <Ionicons name="person-circle-outline" size={20} color="#A68C7B" />
                </View>
                <Text style={styles.itemText}>Edit Profile</Text>
              </View>
              <Ionicons name="chevron-forward" size={18} color="#B0B0B0" />
            </View>
          </TouchableOpacity>
        </View>

        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Applications</Text>
          {String(role || '').toLowerCase() === 'user' && (
            <TouchableOpacity 
              style={[styles.item, hasPendingRequest && styles.itemDisabled]}
              disabled={hasPendingRequest}
              onPress={handleApplyAsArtist}
            >
              <View style={styles.itemRow}>
                <View style={styles.itemLeft}>
                  <View style={styles.itemIconWrap}>
                    <Ionicons name="color-palette-outline" size={20} color="#A68C7B" />
                  </View>
                  <Text style={styles.itemText}>Apply as Artist</Text>
                </View>
                {hasPendingRequest ? (
                  <View style={styles.badge}><Text style={styles.badgeText}>Pending</Text></View>
                ) : (
                  <Ionicons name="chevron-forward" size={18} color="#B0B0B0" />
                )}
              </View>
            </TouchableOpacity>
          )}
          {String(role || '').toLowerCase() === 'artist' && (
            <TouchableOpacity style={styles.item} onPress={() => {}}>
              <View style={styles.itemRow}>
                <View style={styles.itemLeft}>
                  <View style={styles.itemIconWrap}>
                    <Ionicons name="cart-outline" size={20} color="#A68C7B" />
                  </View>
                  <Text style={styles.itemText}>Apply as Seller (Coming Soon)</Text>
                </View>
                <Ionicons name="chevron-forward" size={18} color="#B0B0B0" />
              </View>
            </TouchableOpacity>
          )}
        </View>
      </ScrollView>

      {/* Edit Profile Modal - Transferred from profile.js */}
      <Modal visible={modalVisible} animationType="slide" transparent onRequestClose={() => setModalVisible(false)}>
        <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : 'height'} style={{ flex: 1 }}>
          <View style={styles.uploadModalOverlay}>
            <View style={styles.uploadModalContent}>
              <View style={styles.uploadModalHeader}>
                <Text style={styles.uploadModalTitle}>Edit Profile</Text>
                <TouchableOpacity onPress={() => setModalVisible(false)}>
                  <Ionicons name="close" size={24} color="#333" />
                </TouchableOpacity>
              </View>
              <ScrollView style={styles.uploadModalBody} showsVerticalScrollIndicator={false} keyboardShouldPersistTaps="handled">
                <Text style={styles.uploadInputLabel}>Profile Photo</Text>
                <TouchableOpacity onPress={pickImage} style={styles.uploadImagePicker}>
                  {tempImage ? (
                    <Image source={tempImage} style={styles.uploadPickedImage} />
                  ) : (
                    <View style={styles.uploadImagePlaceholder}>
                      <Ionicons name="person-circle-outline" size={48} color="#A68C7B" />
                      <Text style={styles.uploadImageText}>Tap to change photo</Text>
                    </View>
                  )}
                </TouchableOpacity>
                <Text style={styles.uploadInputLabel}>Cover Photo</Text>
                <TouchableOpacity onPress={pickBackgroundImage} style={styles.uploadImagePicker}>
                  {tempBackgroundImage ? (
                    <Image source={{ uri: tempBackgroundImage.uri }} style={styles.uploadPickedImage} />
                  ) : (
                    <View style={styles.uploadImagePlaceholder}>
                      <Ionicons name="image-outline" size={48} color="#A68C7B" />
                      <Text style={styles.uploadImageText}>Tap to change cover</Text>
                    </View>
                  )}
                </TouchableOpacity>
                <Text style={styles.uploadInputLabel}>First Name</Text>
                <TextInput style={styles.uploadInput} placeholder="First Name" value={tempFirstName} onChangeText={setTempFirstName} />
                <Text style={styles.uploadInputLabel}>Middle Name</Text>
                <TextInput style={styles.uploadInput} placeholder="Middle Name" value={tempMiddleName} onChangeText={setTempMiddleName} />
                <Text style={styles.uploadInputLabel}>Last Name</Text>
                <TextInput style={styles.uploadInput} placeholder="Last Name" value={tempLastName} onChangeText={setTempLastName} />
                <Text style={styles.uploadInputLabel}>Username</Text>
                <TextInput style={styles.uploadInput} placeholder="Username" value={tempUserNameField} onChangeText={setTempUserNameField} />
                <Text style={styles.uploadInputLabel}>Sex</Text>
                <TouchableOpacity style={styles.uploadInput} onPress={() => setShowSexDropdown(!showSexDropdown)}>
                  <Text style={{ color: tempSex ? '#000' : '#999' }}>{tempSex || 'Select Sex'}</Text>
                  <Ionicons name={showSexDropdown ? 'chevron-up' : 'chevron-down'} size={20} color="#555" style={{ position: 'absolute', right: 12, top: 12 }} />
                </TouchableOpacity>
                {showSexDropdown && (
                  <View style={styles.categoryDropdown}>
                    {['Male', 'Female', 'PreferNotToSay'].map(item => (
                      <TouchableOpacity key={item} style={styles.categoryItem} onPress={() => { setTempSex(item); setShowSexDropdown(false); }}>
                        <Text style={styles.categoryItemText}>{item}</Text>
                      </TouchableOpacity>
                    ))}
                  </View>
                )}
                <Text style={styles.uploadInputLabel}>Birthday</Text>
                <TouchableOpacity style={styles.uploadInput} onPress={() => setShowDatePicker(true)}>
                  <Text style={{ color: tempBirthday ? '#000' : '#999' }}>
                    {tempBirthday ? formattedTempDate : 'Select your birthday'}
                  </Text>
                </TouchableOpacity>
                {showDatePicker && (
                  <DateTimePicker value={tempBirthday} mode="date" display="default" onChange={onChangeTempDate} />
                )}
                <Text style={styles.uploadInputLabel}>Address</Text>
                <TextInput style={styles.uploadInput} placeholder="Enter your address" value={tempAddress} onChangeText={setTempAddress} />
                <Text style={styles.uploadInputLabel}>Bio</Text>
                <TextInput style={styles.uploadInput} placeholder="Enter your bio" value={tempBio} onChangeText={setTempBio} />
                <Text style={styles.uploadInputLabel}>About</Text>
                <TextInput style={[styles.uploadInput, styles.uploadTextArea]} placeholder="Write something about yourself" multiline value={tempAbout} onChangeText={setTempAbout} />
                <TouchableOpacity style={styles.uploadButton} onPress={handleSave}>
                  <Text style={styles.uploadButtonText}>Save Changes</Text>
                </TouchableOpacity>
              </ScrollView>
            </View>
          </View>
        </KeyboardAvoidingView>
      </Modal>

      {/* Apply as Artist Modal - Transferred from profile.js */}
      <Modal visible={applyModalVisible} animationType="slide" transparent onRequestClose={() => setApplyModalVisible(false)}>
        <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : 'height'} style={{ flex: 1 }}>
          <View style={styles.uploadModalOverlay}>
            <View style={styles.uploadModalContent}>
              <View style={styles.uploadModalHeader}>
                <Text style={styles.uploadModalTitle}>Apply as Artist</Text>
                <TouchableOpacity onPress={() => setApplyModalVisible(false)}>
                  <Ionicons name="close" size={24} color="#333" />
                </TouchableOpacity>
              </View>
              <ScrollView style={styles.uploadModalBody} showsVerticalScrollIndicator={false} keyboardShouldPersistTaps="handled">
                <Text style={styles.uploadInputLabel}>First Name *</Text>
                <TextInput style={styles.uploadInput} placeholder="First Name" value={appFirstName} onChangeText={setAppFirstName} />
                <Text style={styles.uploadInputLabel}>Middle Initial</Text>
                <TextInput style={styles.uploadInput} placeholder="Middle Initial" value={appMiddleInitial} onChangeText={setAppMiddleInitial} maxLength={1} />
                <Text style={styles.uploadInputLabel}>Last Name *</Text>
                <TextInput style={styles.uploadInput} placeholder="Last Name" value={appLastName} onChangeText={setAppLastName} />
                <Text style={styles.uploadInputLabel}>Phone Number *</Text>
                <TextInput style={styles.uploadInput} placeholder="Phone Number" keyboardType="phone-pad" value={appPhone} onChangeText={setAppPhone} />
                <Text style={styles.uploadInputLabel}>Age *</Text>
                <TextInput style={styles.uploadInput} placeholder="Age" keyboardType="numeric" value={appAge} onChangeText={setAppAge} />
                <Text style={styles.uploadInputLabel}>Sex *</Text>
                <TouchableOpacity style={styles.uploadInput} onPress={() => setAppShowSexDropdown(!appShowSexDropdown)}>
                  <Text style={{ color: appSex ? '#000' : '#999' }}>{appSex || 'Select Sex'}</Text>
                  <Ionicons name={appShowSexDropdown ? 'chevron-up' : 'chevron-down'} size={20} color="#555" style={{ position: 'absolute', right: 12, top: 12 }} />
                </TouchableOpacity>
                {appShowSexDropdown && (
                  <View style={styles.categoryDropdown}>
                    {['Male', 'Female', 'PreferNotToSay'].map(item => (
                      <TouchableOpacity key={item} style={styles.categoryItem} onPress={() => { setAppSex(item); setAppShowSexDropdown(false); }}>
                        <Text style={styles.categoryItemText}>{item}</Text>
                      </TouchableOpacity>
                    ))}
                  </View>
                )}
                <Text style={styles.uploadInputLabel}>Birthdate *</Text>
                <TouchableOpacity style={styles.uploadInput} onPress={() => setAppShowDatePicker(true)}>
                  <Text style={{ color: appBirthdate ? '#000' : '#999' }}>
                    {appBirthdate ? appBirthdate.toLocaleDateString('en-US') : 'Select your birthdate'}
                  </Text>
                </TouchableOpacity>
                {appShowDatePicker && (
                  <DateTimePicker value={appBirthdate} mode="date" display="default" onChange={onChangeAppDate} />
                )}
                <Text style={styles.uploadInputLabel}>Address *</Text>
                <TextInput style={styles.uploadInput} placeholder="Address" value={appAddress} onChangeText={setAppAddress} />
                <Text style={styles.uploadInputLabel}>Valid ID *</Text>
                <TouchableOpacity onPress={pickValidIdImage} style={styles.uploadImagePicker}>
                  {appValidIdImage ? (
                    <Image source={appValidIdImage} style={styles.uploadPickedImage} />
                  ) : (
                    <View style={styles.uploadImagePlaceholder}>
                      <Ionicons name="card-outline" size={48} color="#A68C7B" />
                      <Text style={styles.uploadImageText}>Tap to upload Valid ID</Text>
                    </View>
                  )}
                </TouchableOpacity>
                <Text style={styles.uploadInputLabel}>Selfie *</Text>
                <TouchableOpacity onPress={pickSelfieImage} style={styles.uploadImagePicker}>
                  {appSelfieImage ? (
                    <Image source={appSelfieImage} style={styles.uploadPickedImage} />
                  ) : (
                    <View style={styles.uploadImagePlaceholder}>
                      <Ionicons name="person-outline" size={48} color="#A68C7B" />
                      <Text style={styles.uploadImageText}>Tap to upload Selfie</Text>
                    </View>
                  )}
                </TouchableOpacity>
                <TouchableOpacity
                  style={[styles.uploadButton, appSubmitting && styles.uploadButtonDisabled]}
                  onPress={submitArtistApplication}
                  disabled={appSubmitting}
                >
                  <Text style={styles.uploadButtonText}>
                    {appSubmitting ? 'Submitting...' : 'Submit Application'}
                  </Text>
                </TouchableOpacity>
              </ScrollView>
            </View>
          </View>
        </KeyboardAvoidingView>
      </Modal>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#f5f5f5' },
  content: { padding: 16 },
  section: { 
    backgroundColor: '#fff', 
    borderRadius: 12, 
    marginBottom: 16, 
    overflow: 'hidden',
    elevation: 2,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 1 },
    shadowOpacity: 0.06,
    shadowRadius: 4,
  },
  sectionTitle: { fontSize: 16, fontWeight: '700', paddingHorizontal: 16, paddingVertical: 12, color: '#222', backgroundColor: '#f9f9f9', borderBottomWidth: 1, borderBottomColor: '#eee' },
  item: { paddingHorizontal: 16, paddingVertical: 14, borderBottomWidth: 1, borderBottomColor: '#f0f0f0' },
  itemText: { fontSize: 15, color: '#333' },
  itemRow: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between' },
  itemLeft: { flexDirection: 'row', alignItems: 'center', gap: 10 },
  itemIconWrap: { 
    width: 28, 
    height: 28, 
    borderRadius: 6, 
    backgroundColor: '#F4EFEA', 
    alignItems: 'center', 
    justifyContent: 'center' 
  },
  itemDisabled: { opacity: 0.5 },
  badge: { backgroundColor: '#FFF2D6', paddingHorizontal: 10, paddingVertical: 4, borderRadius: 999 },
  badgeText: { color: '#9A7B4F', fontSize: 12, fontWeight: '700' },
  uploadModalOverlay: { 
    flex: 1, 
    backgroundColor: 'rgba(0,0,0,0.5)', 
    justifyContent: 'flex-end'
  },
  uploadModalContent: { 
    backgroundColor: '#fff', 
    borderTopLeftRadius: 20, 
    borderTopRightRadius: 20, 
    maxHeight: '90%'
  },
  uploadModalHeader: { 
    flexDirection: 'row', 
    justifyContent: 'space-between', 
    alignItems: 'center', 
    padding: 20, 
    borderBottomWidth: 1, 
    borderBottomColor: '#e0e0e0'
  },
  uploadModalTitle: { fontSize: 20, fontWeight: 'bold', color: '#A68C7B' },
  uploadModalBody: { padding: 20 },
  uploadInputLabel: { fontSize: 14, fontWeight: '600', color: '#333', marginBottom: 8 },
  uploadInput: { borderWidth: 1, borderColor: '#e0e0e0', borderRadius: 8, padding: 12, fontSize: 14, backgroundColor: '#fff' },
  uploadTextArea: { height: 100, textAlignVertical: 'top' },
  uploadButton: { backgroundColor: '#A68C7B', paddingVertical: 15, borderRadius: 8, alignItems: 'center', marginTop: 10, marginBottom: 20 },
  uploadButtonDisabled: { opacity: 0.6 },
  uploadButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  uploadImagePicker: { 
    width: '100%', 
    height: 200, 
    borderRadius: 12, 
    borderWidth: 2, 
    borderColor: '#A68C7B', 
    borderStyle: 'dashed', 
    marginBottom: 20, 
    overflow: 'hidden'
  },
  uploadImagePlaceholder: { flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: '#f9f9f9' },
  uploadImageText: { marginTop: 10, fontSize: 14, color: '#A68C7B' },
  uploadPickedImage: { width: '100%', height: '100%', resizeMode: 'cover' },
  categoryDropdown: { 
    backgroundColor: '#fff', 
    borderWidth: 1, 
    borderColor: '#e0e0e0', 
    borderRadius: 8, 
    marginTop: -8, 
    marginBottom: 16, 
    elevation: 3, 
    shadowColor: '#000', 
    shadowOffset: { width: 0, height: 2 }, 
    shadowOpacity: 0.1, 
    shadowRadius: 4 
  },
  categoryItem: { paddingVertical: 12, paddingHorizontal: 16, borderBottomWidth: 1, borderBottomColor: '#f0f0f0' },
  categoryItemText: { fontSize: 15, color: '#333' },
});
